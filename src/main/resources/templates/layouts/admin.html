<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	th:with="currentPage=${currentPage}">
<head>
<meta charset="UTF-8" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title layout:fragment="title">Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- Bootstrap 5.3.2 CSS from CDN -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" 
      rel="stylesheet" 
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" 
      crossorigin="anonymous"
      onerror="this.onerror=null; this.href='/css/bootstrap.min.css';">

<!-- Bootstrap Icons -->
<link rel="stylesheet" 
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
      integrity="sha384-XGjxtQfXaH2tnPFa9x+ruJTuLE3Aa6LhHSWRr1XeTyhezb4abCG4ccI5AkVDxqC+" 
      crossorigin="anonymous">

<!-- Custom CSS (loads after Bootstrap) -->
<link rel="stylesheet" th:href="@{/css/custom.css}">
<link rel="stylesheet" th:href="@{/css/admin.css}">
</head>
<body layout:fragment="page" class="admin-body">

	<!-- Admin Dashboard Layout with Flex -->
	<div class="admin-dashboard d-flex">
		<!-- Sidebar -->
		<nav class="sidebar bg-dark text-white" id="adminSidebar">
			<div th:replace="~{fragments/sidebar :: sidebar}"></div>
		</nav>
		
		<!-- Main Content Area -->
		<main class="main-content flex-grow-1" id="admin-main-content" tabindex="-1">
			<!-- Top Navigation Bar -->
			<nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom sticky-top">
				<div class="container-fluid">
					<!-- Sidebar Toggle Button -->
					<button class="btn btn-link text-dark" type="button" id="sidebarToggleBtn">
						<i class="bi bi-list fs-4"></i>
					</button>
					
					<!-- Page Title (optional, can be set by individual pages) -->
					<span class="navbar-brand mb-0 h1 ms-2" layout:fragment="pageTitle">Dashboard</span>
					
					<!-- User Menu -->
					<div class="ms-auto d-flex align-items-center">
						<div class="dropdown">
							<button class="btn btn-link text-dark dropdown-toggle" type="button" 
							        id="userMenuDropdown" data-bs-toggle="dropdown" aria-expanded="false">
								<i class="bi bi-person-circle fs-5"></i>
								<span class="ms-2 d-none d-md-inline" sec:authentication="name">Admin</span>
							</button>
							<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenuDropdown">
								<li><a class="dropdown-item" th:href="@{/profile}">
									<i class="bi bi-person me-2"></i>Profile
								</a></li>
								<li><a class="dropdown-item" th:href="@{/}">
									<i class="bi bi-house me-2"></i>View Site
								</a></li>
								<li><hr class="dropdown-divider"></li>
								<li><a class="dropdown-item" th:href="@{/logout}">
									<i class="bi bi-box-arrow-right me-2"></i>Logout
								</a></li>
							</ul>
						</div>
					</div>
				</div>
			</nav>
			
			<!-- Page Content -->
			<div class="container-fluid p-4">
				<!-- Global Message Container -->
				<div class="alert-container mb-3">
					<!-- Success Message -->
					<div th:if="${successMessage}" 
					     class="alert alert-success alert-dismissible fade show auto-hide" role="alert">
					    <i class="bi bi-check-circle me-2"></i>
					    <span th:text="${successMessage}">Operation completed successfully!</span>
					    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
					</div>
					
					<!-- Error Message -->
					<div th:if="${errorMessage}" 
					     class="alert alert-danger alert-dismissible fade show auto-hide" role="alert">
					    <i class="bi bi-exclamation-triangle me-2"></i>
					    <span th:text="${errorMessage}">An error occurred!</span>
					    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
					</div>
					
					<!-- Warning Message -->
					<div th:if="${warningMessage}" 
					     class="alert alert-warning alert-dismissible fade show auto-hide" role="alert">
					    <i class="bi bi-exclamation-circle me-2"></i>
					    <span th:text="${warningMessage}">Warning!</span>
					    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
					</div>
					
					<!-- Info Message -->
					<div th:if="${infoMessage}" 
					     class="alert alert-info alert-dismissible fade show auto-hide" role="alert">
					    <i class="bi bi-info-circle me-2"></i>
					    <span th:text="${infoMessage}">Information</span>
					    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
					</div>
				</div>
				
				<div layout:fragment="content">
					<!-- Page-specific content goes here -->
				</div>
			</div>
		</main>
	</div>
	
	<!-- Bootstrap 5.3.2 JS from CDN -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" 
	        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" 
	        crossorigin="anonymous"
	        onerror="this.onerror=null; this.src='/js/bootstrap.bundle.min.js';"></script>
	
	<!-- Custom JS -->
	<script th:src="@{/js/custom.js}"></script>
	
<!-- 	<script th:if="${message}" th:inline="javascript">
    	alert([[${message}]]);
	</script> -->
	<script>
	    document.addEventListener("DOMContentLoaded", function () {
	        const alerts = document.querySelectorAll(".auto-hide");
	
	        alerts.forEach(alert => {
	            setTimeout(() => {
	                alert.classList.add("fade");
	                alert.classList.remove("show");
	
	                // remove from DOM after fade
	                setTimeout(() => alert.remove(), 500);
	            }, 3000);
	        });
	    });
	</script>
	<script th:if="${currentPage == 'account' || currentPage == 'product'}">
	    function previewImage(input) {
		        const preview = document.getElementById('imagePreview');
		
		        if (input.files && input.files[0]) {
		            const reader = new FileReader();
		
		            reader.onload = function (e) {
		                preview.src = e.target.result;
		                preview.style.display = 'block';
		            };
		
		            reader.readAsDataURL(input.files[0]);
		        }
		        console.log("previewImage triggered");
		    }
	</script>
	<script th:if="${currentPage == 'discount'}">
	    const discountTypeSelect = document.getElementById("discountType");
	    const discountValueInput = document.getElementById("discountValue");
	
	    function updateStep() {
	        if (discountTypeSelect.value === "percent") {
	            discountValueInput.step = "1";
	            discountValueInput.max = "100";
	        } else {
	            discountValueInput.step = "1";
	            discountValueInput.removeAttribute("max");
	        }
	    }
	
	    // On page load
	    updateStep();
	
	    // On change
	    discountTypeSelect.addEventListener("change", updateStep);
	    
	    /* if input more than limit then set value equal to limit */
	    const input = document.getElementById("discountValue");

	    input.addEventListener("input", function () {
	        const max = parseFloat(this.max);
	        const value = parseFloat(this.value);

	        if (!isNaN(value) && value > max) {
	            this.value = max;
	        }
	    });
	</script>
</body>
</html>